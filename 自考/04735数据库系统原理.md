# 数据库系统原理
## 1 数据库系统概述
### 1.1 数据库系统基本概念
数据： 描述事实的符号记录。包括数字、字母、文字等。

<b id="database-system">数据库</b>： 长期存储在计算机，有组织的，可共享的大量数据集合。

数据库管理系统：位于用户与操作系统之间的一层数据库管理软件。功能包含
* 数据定义功能，定义数据库中的数据对象，建表。
* 数据控制功能，数据的增删改查。
* 数据库的运行管理，保证数据的安全性、完整性、多用户队数据库的并发使用以及故障后的系统恢复。
* 数据库的建立和维护功能。
* 数据组织、存储和管理功能。
* 其他功能，如与其他软件的网络通信功能。

数据库系统：指在计算机中引入数据库技术之后的系统，包括数据库、数据库管理系统及相关实用工具、应用程序、数据库管理员和用户。
### 1.2 数据管理技术的发展
`数据管理技术共经历了人工管理、文件系统和数据库系统三个阶段。`

 人工管理阶段：所涉及的数据处理工作基本都是靠手工方式来进行，硬件方面的数据只能放在纸带或者卡片上。***记录内无结构，整体无结构。***
   * 数据不保存
   * 没有应用程序管理数据
   * 数据面向应用

 文件系统阶段：将数据的逻辑结构和物理结构分离，由“存放方法”实现逻辑结构与物理结构之间的映射。***记录内有结构，整体无结构。***
   * 数据可长期存储。
   * 不能实现数据的普通共享，只能实现文件级的共享。

**数据库系统阶段**： [数据库](#database-system)包含以下特点
   * 数据集成
   * 数据共享性高
   * 数据冗余小：不用重复存储，避免漏更新，保证数据一致性。
   * 数据一致性好
   * 数据独立性高
   * 实施统一管理与控制
   * 减少应用程序开发与维护的工作量
### 1.3 数据库系统的结构

**三级模式结构**：用户级、概念级和物理级
   * 外模式：也称为子模式或用户模式，是数据库用户（包括程序员和最终用户）能够看见和使用的局部数据的逻辑结构和特征描述。
   * 模式：也称为概念模式或逻辑模式，是数据库中全体数据的逻辑结构和特征描述。
   * 内模式：也称为存储模式，是对数据库中数据物理结构和存储方式的描述。设计围绕提高数据库性能和有效存储空间。

数据独立性：指使用数据的应用程序和数据库的数据之间相互独立，不受影响。即数据或应用程序的修改不会引起另一方的修改。

外模式-模式映像：定义了各个外模式与模式之间的映像关系，指出映像双方是如何进行转换的。保证了逻辑独立性。

模式-内模式映像：定义了数据库全局逻辑结构与物理存储之间的对应关系。保证了物理独立性。

外部体系结构：集中式结构、分布式结构和并行结构。

运行与应用结构：
   * 客户/服务器结构（C/S）：使用命令行客户端、图形化界面管理工具、应用程序等来连接数据库管理系统。
   * 浏览器/服务器结构（B/S）：也称三层客户/服务器结构，将与数据库系统交互的客户端进一步细分为“表示层”和“处理层”。其中，“表示层”是数据库使用者操作和展示界面，通常为浏览器。而“处理层”则主要负责数据库使用者的具体应用逻辑，与后台的数据库管理系统组成功能更加丰富的“胖服务器”。

### 1.4 数据模型
`描述数据的结构、定义数据的操作以及对数据间的约束。`

**数据结构**： 描述系统的**静态特性**，即数据对象的类型、内容及数据对象之间的联系。

**数据操作**：描述系统的**动态特性**， 是数据对象的实例允许执行操作的集合及有关的操作规则。

**数据约束**： 描述数据结构中数据间的语法、语义关联，包括相互制约规则。保证数据的正确性、有效性与相容性。

实体：客观存在并可相互区别的事物。

属性：实体所具有的某种特性，实体由若干特性来刻画。

码：唯一标识实体属性集称为码。

域：属性的取值范围。

实体型：用实体名、属性名集合来抽象刻画同类实体，称为实体型。

实体集：同型实体的集合，称为实体集。

联系： 实体内部以及事物之间的联系。实体内部之间的联系，各属性之间的联系；实体之间的联系，一对多、一对一、多对多。

概念层数据模型：描述现实世界的事物，与具体的计算机系统无关。通常用E-R图（E-R模型）来表示。实体用矩形框，联系用菱形框，属性用椭圆框。

逻辑层数据模型：描述数据整体逻辑结构，是数据抽象的中间层。包括层次模型、网状模型、关系模型、面向对象模型等。

物理层数据模型：描述数据在存储介质上的组织结构，是逻辑模型的物理实现。

## 2 关系数据库
### 2.1 关系数据库概述

**基本特征**：使用关系数据模型组织数据。

常见系统：FoxPro、Access以及MySQL。

### 2.2 关系数据模型
`关系模型包含三个组成要素，分别是关系数据结构、关系操作集合和关系完整性约束。`
#### 2.2.1 关系数据结构

名词释义：
   * 表：也称关系，是一个二维数据结构。有表名和构成表的行、列组成。每个表的表名是唯一的。
   * 关系：一个关系逻辑对应一张二维表，可以为每个关系取一个名称进行标识。有基本关系、查询表和视图表三种。
   * 列（属性/字段）：表示实体的一个属性，有相同的数据类型。表中每列有一个名称，称为列明、属性名或字段名。
   * 元（度）：属性的个数。
   * 行（元祖/记录）：表中的数据是按行存储的，每行有若干字段值组成，每个字段值描述该对象的一个属性或特征。
   * 分量：元祖中的一个属性值。
   * 码（键/key）：如果存在一个关系中，存在这样的属性（或属性组），使得该关系的任何两个元祖，在该属性（或属性组）上值的组合都不相同，即这些属性（或属性组）的值能用来唯一标识该关系的元祖，则称为属性（或属性组）为该关系的码或键；
   * 超码（超键）：如果在关系的一个码或键中移去某个属性，它仍然是这个关系的码，则称这样的码或键为该关系的超码或超键。
   * 候选码（候选键）：如果在关系的一个码或键中，不能移去某个属性，否则它就不是这个关系的码或键，则称为这样的码或键为该关系的候选码或候选键。
   * 主码（主键）：在一个关系的若干个候选码或候选键中，指定一个用来唯一标识关系的元祖，则称这个被指定的候选码或候选键为该关系的主码或主键。
   * 全码（全键）：在一个关系中，任何一个码或键皆可以用来唯一标识关系的元祖，则这样的主码或主键称为全码。
   * 主属性和非主属性：关系中包含在任何一个候选码中的属性称为主属性，不包含在候选码中的属性称为非主属性。
   * **外码（外键）**：当关系中的某个属性（或属性组）不是这个关系的主码或候选码，而是另一个关系的主码是，称该属性（或属性组）为这个关系的外码或外键。
   * 参照关系和被参照关系：指以外码相关联的两个关系，以外码为主码的关系称为被参照关系，外码所在的关系称为参照关系。
   * 域：属性的取值范围。
   * 数据类型：表示每个列中都有相应的数据类型，用于限制该列中存储的数据。
   * 关系模式：同数据模型一样，数据库也有“型”和“值”之分。在关系数据库中，关系模式是型，关系是值，即关系模式是对关系的描述。

      `表名（属性1， 属性2，...）`
   * 关系数据库：关系数据库是以关系模型为数据的逻辑模型，并采用关系作为数据组织方式的一类数据库，其数据库操作建立在关系代数的基础上。

**关系数据库对关系的具体要求**：
   * 每一个属性都是不可分解的。
   * 每一个关系仅仅有一种关系模式，即每一种关系模式中的属性的数据类型以及属性的个数是相对固定的。
   * 每一个关系模式中的属性必须命名，在同一个关系中，属性名必须是不同的。
   * 同一个关系中不允许出现候选码或候选键，值完全相同的元祖。
   * 在关系中元祖的顺序是无关紧要的，可以任意交换。
   * 在关系中属性的顺序是无关紧要的，可以任意交换。
#### 2.2.2 关系操作集合

基本关系操作：
   * **查询**：选择、投影、连接、除、并、交、差、笛卡尔积
   * 数据更新：插入、删除、修改

关系操作特点：集合操作方式，即操作的对象和结果都是集合。

关系数据语言分类：`SQL 兼具关系代数语言与逻辑演算语言`
   * 代数方式：主要有关系代数，他是通过对关系的操作来表达查询要求的方式。
   * 逻辑方式：主要有关系演算，他是用谓词来表达查询要求的方式。
   
关系代数：以集合代数为基础发展起来的，是关系操作语言的一种传统表示方式。操作三要素：操作对象、操作符、操作结果。其中，操作对象和操作结果均为关系（集合）；
   * 传统的集合运算：并集、差集、交集、笛卡尔积。
   * 专门的关系运算：
      * 选择：从指定关系中选取满足给定条件的若干元祖组成一个新的关系。

         `SELECT 关系名 WHERE 条件`
      * 投影：从指定关系中选取指定若干属性值组成一个新的关系。

         `PROJECTION 关系名(属性名1, 属性名2, ...)`
      * 连接：选取两个指定关系中的属性满足给定条件的元祖连接在一起组成一个新的关系。

         `JOIN 关系名1 AND 关系名2 WHERE 条件`
      * 除：若被除关系为R，除关系为S，则运算结果为一个R-S元关系。在进行除运算时，先将被除关系中的R-S列按值的不同分成若干组，然后检查每个组，看R-S列以外的那些列中是否包含除关系的全部元祖，包含则取该R-S列的值为商关系的一个元祖，否责不取。
#### 2.2.3 关系的完整性约束

完整性：数据库中数据与现实世界中应用需求的数据或数据库内数据之间的正确性、相容性和一致性。

完整性约束：数据完整性由完整性规则来定义，关系模型的完整性规则是对关系的某种约束。
   1. 实体完整性约束：指关系的主码组成不能为空。
   2. 参照完整性约束：定义外码和主码之间的引用规则，它是对引用数据的一种限制。
   3. 用户定义完整性约束：针对某一应用环境的完整性约束条件。

完整性约束的校验：
   1. 执行插入操作：
      * 首先检查实体完整性，即检查主码属性值是否存在？或者是否为空？
      * 再检查参照完整性，向参照关系加入时，检查外码属性上的值是否在被参照关系的主码属性值中存在？
      * 最后检查用户定义完整性，检查要被插入的元祖中各属性值是否满足域完整性约束和其他特殊定义的完整性规则。
   2. 执行删除操作：一般只需要对被参照关系检查参照完整性约束。
   3. 执行更新操作：更新操作可以看成是先执行删除操作，再执行插入操作。

### 2.3 关系数据库的规范化理论
`关系数据库的规范化理论是关系数据库设计的理论依据。`
#### 2.3.1 关系模式中可能存在的冗余和异常问题
`从设计的角度来看，关系模式有“好”与“不好”之分。“不好”的关系模式可能存在如下问题。`
1. 数据冗余： 指同一数据被反复存储的情况。
2. 更新异常：数据冗余将导致存储空间浪费和潜在数据不一致性及修改麻烦等问题。
3. 插入异常：指应该插入到数据库中的数据不能执行插入操作的情况。如，一个关系包含学生信息，也包括选课信息及授课教师信息，若需要单独插入授课教师信息的情况。
4. 删除异常：指不应该删去的数据被删去的情况。
#### 2.3.2 函数依赖与关键字

**函数依赖**：关系中属性间的对应关系。在关系中，若属性X的每一个值，属性Y只有唯一值与之对应，则称X函数决定Y或属性Y依赖于属性X（X -> Y）;
   1. 完全函数依赖：X、Y为属性集，且X -> Y; 对于X的任何真子集X', 有
   X' -> Y 不成立，则称Y完全函数依赖于X。
   2. 部分函数依赖：X、Y为属性集，且X -> Y; 对于X存在一个真子集X',有X' -> Y 成立，则称Y部分函数依赖于X。
   3. 传递函数依赖：X、Y、Z为属性集，X -> Y 、Y -/> X、Y-> Z，有 X -> Z, 则Z传递函数依赖于X。

候选关键字：给定关系所有属性集合U，X为U的子集，若有完全函数依赖X -> U, 则X为该关系的一个候选关键字。

主键：一个关系中可能含有多个候选关键字，通常选择其中之一作为主关键字，即主键。

主属性：候选关键字中所含有的属性称为主属性。

#### 2.3.3 范式与关系规范化过程
`关系数据库中的关系需要满足一定的要求，不同程度的要求称为内不同的范式（NF）。`

1. 第一范式(1NF)：给定关系不含重复组，其中不存在嵌套结构。
2. 第二范式(2NF)：给定关系满足1NF，且所有非主属性完全函数依赖于候选关键字。
3. 第三范式(3NF)：给定满足2NF，且所有非主属性都不传递函数依赖于候选关键字。
4. BCNF: 给定关系满足3NF，X、Y为其属性集，F为其函数依赖集; 有F中所有函数依赖X -> Y(Y不属于X)中的X必包含候选关键字，则该关系为BCNF。

   `BCNF解决了3NF中出现的插入及删除操作异常等问题`
#### 2.3.4 关系规范化理论的应用
`关系规范化理论主要应用于数据库设计中的概念设计阶段，对所产生的概念设计，可用它来分析其实体划分是否合适，判断属性分配到哪个实体中更为合理。`
## 3 数据库设计
### 3.1 数据库设计概述
`数据库设计使将数据库系统与现实世界进行密切地、有机地、协调一致的结合过程。`

数据库生命周期：
   * 数据库分析与设计阶段：包括需求分析、概念设计、逻辑设计和物理设计。
   * 数据库实现与操作阶段：包括数据库的实现、操作与监督、修改与调整三个子阶段。

数据库设计的目标：
   * 满足应用功能需求：主要指用户当前与可预知的将来应用所需的数据及其联系，应全部准确地存储在数据库之中，从而满足用户应用对数据增、删、改、查的需求。
   * 良好的数据库性能：主要指用户对数据的高效率存取和空间的节省，并具有良好的数据共享性、完整性、一致性及安全保密性。

数据库设计的内容：从用户对数据的需求出发，研究并构造数据库的过程
   * 结构设计
   * 行为设计

数据库设计的方法：
   * 直观设计法：利用设计者的经验和技巧来设计
   * 规范设计法：
      1. 新奥尔良设计方法
      2. 基于E-R模型的数据库设计方法
      3. 基于第三范式的设计方法
   * 计算机辅助设计法

数据库设计的过程：
   1. 需求分析阶段
   2. 结构设计与行为设计阶段
   3. 数据库实施阶段：加载和调试运行应用程序
   4. 数据库运行于维护阶段。

### 3.2 数据库设计的基本步骤

需求分析：
   1. 确定数据库范围：确定数据库应支持那些应用功能。
   2. 应用过程分析：分析每一部门或应用需要用到哪些数据、数据的使用顺序、对数据作何处理、处理策略以及处理的结果。
   3. 收集与分析数据
      1. 静态结构：不施加应用操作于其上时数据的原始状况
      2. 动态结构：应用施加于数据之上之后的数据情况
      3. 数据约束：数据的安全保密性、完整性、响应时间和数据恢复
   4. 编写需求分析报告：
      1. 数据库的应用功能目标：功能和性能目标
      2. 标明不同用户视图范围：不同用户的数据使用范围
      3. 应用处理过程需求说明：数据流程图、任务分类表、数据操作特征表以及操作过程说明书。
      4. 数据字典：专有字段、属性、操作的解释表
      5. 数据量：数据总量
      6. 数据约束

概念结构设计：在需求分析报告的基础上，设计满足应用需求的概念模型。常用设计方法有**实体分析法和属性综合法**。

逻辑结构设计：将概念模型转换为等价的DBMS所支持的数据模型结构。

物理设计：对于给定的数据库逻辑结构，研究并构造物理结构的过程，其具体任务主要是确定数据库在存储设备上的存储结构以及存取方法。

数据库实施：根据数据库逻辑结构和物理设计，在实际的计算机系统中建立数据库并试运行。
   1. 加载数据：将符合要求的初始数据装载到数据库中去
   2. 应用程序设计：编写数据的增删改查
   3. 数据库试运行：对数据库进行各种操作，检验其功能和性能

数据库运维：经过试用测试后，投入生产环境中运行。做好维护工作、发现和分析问题；对数据进行转储，对系统故障进行恢复处理等。最难的是数据库重组与重构。